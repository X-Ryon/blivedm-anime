# Bilibili 直播弹幕姬 - 前端设计规划书

## 1. 项目概述

本项目旨在构建一个**游戏化、强交互**的 Bilibili 直播弹幕姬前端。除了基础的弹幕展示功能外，核心特色在于将“上舰/送礼”行为转化为可视化的“孵化与角色养成”动画，极大地增强直播间的趣味性和观众参与感。同时，项目原生支持 **OBS 浏览器源嵌入**，方便主播直接使用。

## 2. 技术架构选型

| 维度 | 技术选型 | 选择理由 |
| :--- | :--- | :--- |
| **核心框架** | **React 18** | 组件化开发模式完美契合“每个观众是一个独立角色”的逻辑；生态丰富。 |
| **构建工具** | **Vite** | 极速冷启动与热更新，提供最佳开发体验。 |
| **UI 组件库** | **Ant Design 5.x** | 用于构建“控制台”页面（设置、连接管理），美观且功能强大。 |
| **动画引擎** | **Framer Motion** | 处理 React 组件的进出场、位移过渡，API 优雅且性能好。 |
| **复杂动画** | **Lottie-web** | 用于播放高质量的“孵化”动画（JSON 格式），矢量不失真，体积小。 |
| **状态管理** | **Zustand** | 轻量级状态管理，用于在 WebSocket、设置页与动画层之间同步数据。 |
| **通信协议** | **WebSocket** | 接收后端转发的 B 站直播流事件（弹幕、礼物、上舰）。 |

## 3. 页面模式设计

系统将包含两种主要视图模式，通过 URL 路由区分：

### 3.1 控制台模式 (Admin Dashboard)
*   **路由**: `/admin`
*   **功能**:
    *   连接管理：输入 Room ID，查看连接状态。
    *   规则配置：设置孵化触发门槛（如：仅舰长孵化、仅大额礼物孵化）。
    *   美术配置：上传/选择不同等级对应的角色皮肤。
    *   预览窗口：实时预览 OBS 输出效果。
*   **UI 风格**: 标准 Ant Design 后台风格，清晰、整洁。

### 3.2 沉浸模式 (OBS Overlay)
*   **路由**: `/overlay?room={roomId}&bg=transparent`
*   **功能**: 专为 OBS 设计的纯展示页面。
*   **特性**:
    *   **背景全透明**: 确保不遮挡游戏或摄像头画面。
    *   **无 UI 边框**: 移除所有按钮、滚动条和非必要元素。
    *   **自适应分辨率**: 适配 1920x1080 或自定义尺寸的 OBS 画布。

## 4. 核心功能与动画交互设计

### 4.1 孵化系统 (核心玩法)
当监听到 `GUARD_BUY` (上舰) 或指定 `SEND_GIFT` 事件时：

1.  **生成阶段 (Spawn)**
    *   在屏幕底部随机 X 轴位置生成一颗“神秘蛋”。
    *   **动画**: 蛋从天而降或淡入出现，带有弹性落地效果 (Bounciness)。

2.  **孵化阶段 (Hatching)**
    *   **持续时间**: 约 2 秒。
    *   **表现**: 播放 `egg_hatching.json` (Lottie) 或序列帧动画。蛋壳产生裂纹、晃动、发出光芒。

3.  **破壳阶段 (Birth)**
    *   **动画**: 蛋壳炸裂消失（粒子效果可选），原有位置瞬间切换为“大米角色”。
    *   **过渡**: 建议使用“光效遮罩”来掩盖素材切换的突兀感。

### 4.2 角色行为系统
孵化后的角色将常驻屏幕（直至超时消失或被新角色挤掉）：

*   **身份标识**:
    *   角色头顶显示半透明黑色气泡，内含用户昵称。
    *   不同身份（舰长/提督）对应不同的大米形象（皮肤）。
*   **随机游走 (AI)**:
    *   角色在屏幕底部一定区域内（如 `bottom: 0px ~ 200px`）随机左右移动。
    *   移动时播放“行走”动画（或左右摇摆），停止时播放“待机”动画。
*   **弹幕气泡**:
    *   当该用户发送弹幕时，不显示在公屏瀑布流，而是从该角色头顶冒出一个漫画风格的对话气泡，持续 3-5 秒后消失。

## 5. 美术资源需求书 (Art Assets Spec)

为了达到最佳效果，请按照以下规范准备资源：

### 5.1 孵化动画资源
| 资源名称 | 格式推荐 | 尺寸建议 | 说明 |
| :--- | :--- | :--- | :--- |
| **神秘蛋_静止** | PNG/WebP | 200x200px | 透明背景，底部中心对齐。 |
| **蛋_孵化过程** | **Lottie (JSON)** <br> 或 WebP 序列帧 | 200x200px | 包含蛋晃动、裂开、发光的完整过程。**重点：最后一帧必须是完全消失或全白光，以便无缝切换角色。** |

### 5.2 角色形象资源 (大米系列)
建议为不同等级准备不同皮肤（如：普通大米、舰长装大米、提督装大米）。

| 资源名称 | 格式推荐 | 尺寸建议 | 说明 |
| :--- | :--- | :--- | :--- |
| **角色_待机 (Idle)** | PNG (静态) <br> 或 GIF/WebP (动态) | 256x256px | 角色正面或侧面站立，**重心点位于图片底部中心**。 |
| **角色_行走 (Walk)** | GIF/WebP | 256x256px | (可选) 如果没有行走动画，程序将使用“左右摇摆”代码模拟走路。 |

### 5.3 UI 资源
*   **对话气泡**: 9-slice (九宫格) 格式的 PNG，用于承载不定长的弹幕文字。
*   **身份勋章**: (可选) 显示在名字旁边的小图标。

## 6. OBS 嵌入指南

1.  在 OBS 中添加 **"浏览器 (Browser)"** 源。
2.  **URL**: 输入前端部署地址，并附带参数，例如：
    `http://localhost:3000/overlay?room=22625025&transparent=true`
3.  **自定义 CSS** (OBS 属性页):
    ```css
    body { background-color: rgba(0, 0, 0, 0); margin: 0px auto; overflow: hidden; }
    ```
4.  **宽高设置**: 建议设置为 `1920 x 1080` (全屏覆盖) 或 `1920 x 300` (仅底部活动区)。

---
**附注**: 
*   **性能优化**: 如果同屏角色超过 50 个，我们将自动开启“低性能模式”，停止非活跃角色的随机游走，仅保留新角色的动画。
*   **兜底策略**: 如果美术资源未就绪，程序将使用 CSS 绘制的简单几何图形（圆形代替蛋，方块代替人）作为占位符，不影响开发进度。
