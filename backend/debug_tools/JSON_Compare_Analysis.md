# Bilibili 直播 DANMU_MSG 原始 JSON 数据对比分析

**对比文件**:
1.  `raw.json`: 匿名连接（无 Cookie）获取的数据。
2.  `raw2.json`: 登录连接（带 Cookie）获取的数据。

**结论**:
使用 SESSDATA 登录后，获取到的 `DANMU_MSG` 信息量**显著增加**，主要体现在**用户真实身份的解锁**上。匿名状态下，许多关键用户字段被 B 站服务端“脱敏”或隐藏（显示为 0 或默认值），而登录后可获取完整的 UID、头像、用户名等信息。

## 详细差异对比

| 字段路径 | 含义 | raw.json (匿名) | raw2.json (登录) | 分析 |
| :--- | :--- | :--- | :--- | :--- |
| `info[2][0]` | **用户 UID** | `0` | `3772038` | **核心差异**。匿名状态下 UID 被屏蔽为 0，无法唯一标识用户；登录后可获取真实 UID。 |
| `info[0][15]['user']['base']['name']` | 用户名 | `"X***"` | `"XRyon"` | **核心差异**。匿名状态下用户名被部分打码（如 "X***"），登录后显示完整用户名。 |
| `info[0][15]['user']['base']['face']` | 用户头像 | `.../fecf...webp` | `.../fecf...webp` | 似乎一致，但在某些情况下匿名可能会获取默认头像。 |
| `info[0][15]['user']['uid']` | 用户 UID (冗余) | `0` | `3772038` | 同样被屏蔽。 |
| `info[2][1]` | 用户名 (数组位置) | `"X***"` | `"XRyon"` | 同样被打码。 |

## 其他发现

1.  **元数据完整性**:
    *   除了用户身份信息外，弹幕本身的属性（如颜色、模式、时间戳 `ts`、内容 `content`）在两种模式下基本一致。
    *   `info[0][15]['extra']` 中的 `user_hash` 在两种模式下均存在且一致（`"2897820454"`），说明即使在匿名模式下，B 站也通过 Hash 值来区分用户，但无法反查真实 UID。

2.  **业务影响**:
    *   **如果您的功能依赖于用户唯一性（如积分统计、抽奖、黑名单）**：必须使用**带 Cookie (SESSDATA)** 的连接方式，否则无法获取真实 UID，且用户名可能重复（打码后）。
    *   **如果仅做弹幕展示**：匿名连接勉强可用，但显示的用户名为打码状态，体验较差。

## 建议

强烈建议在生产环境中使用**带 SESSDATA** 的连接方式，以确保数据的完整性和用户身份的准确识别。
