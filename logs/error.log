2026-01-27 10:31:04.512 | ERROR    | - | Traceback (most recent call last):
  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\_compat.py", line 60, in asyncio_run
    return loop.run_until_complete(main)
  File "E:\conda_envs\dmj\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
  File "E:\conda_envs\dmj\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
  File "E:\conda_envs\dmj\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
  File "E:\conda_envs\dmj\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\server.py", line 70, in serve
    with self.capture_signals():
  File "E:\conda_envs\dmj\lib\contextlib.py", line 142, in __exit__
    next(self.gen)
  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\server.py", line 331, in capture_signals
    signal.raise_signal(captured_signal)
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\conda_envs\dmj\lib\site-packages\starlette\routing.py", line 701, in lifespan
    await receive()
  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\lifespan\on.py", line 137, in receive
    return await self.receive_queue.get()
  File "E:\conda_envs\dmj\lib\asyncio\queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

2026-01-27 10:33:58.097 | ERROR    | - | Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "E:\conda_envs\dmj\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 196
               │     └ 3
               └ <function _main at 0x000001689F3AE710>

  File "E:\conda_envs\dmj\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 196
           │    └ <function BaseProcess._bootstrap at 0x000001689F2B9A20>
           └ <SpawnProcess name='SpawnProcess-14' parent=14612 started>

  File "E:\conda_envs\dmj\lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001689F2B9090>
    └ <SpawnProcess name='SpawnProcess-14' parent=14612 started>

  File "E:\conda_envs\dmj\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001689EFBB190>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-14' parent=14612 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-14' parent=14612 started>
    │    └ <function subprocess_started at 0x00000168A17A1630>
    └ <SpawnProcess name='SpawnProcess-14' parent=14612 started>

  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=756, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001689EFBB160>>

  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio_run(self.serve(sockets=sockets), loop_factory=self.config.get_loop_factory())
           │           │    │             │                      │    │      └ <function Config.get_loop_factory at 0x00000168A16EF520>
           │           │    │             │                      │    └ <uvicorn.config.Config object at 0x000001689EFBB190>
           │           │    │             │                      └ <uvicorn.server.Server object at 0x000001689EFBB160>
           │           │    │             └ [<socket.socket fd=756, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8000)>]
           │           │    └ <function Server.serve at 0x00000168A1786050>
           │           └ <uvicorn.server.Server object at 0x000001689EFBB160>
           └ <function asyncio_run at 0x00000168A128A680>

  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\_compat.py", line 60, in asyncio_run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000168A11E6EA0>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000168A1034C10>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "E:\conda_envs\dmj\lib\asyncio\base_events.py", line 636, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000168A1034B80>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "E:\conda_envs\dmj\lib\asyncio\base_events.py", line 603, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000168A1036680>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "E:\conda_envs\dmj\lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000168A0F8E050>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "E:\conda_envs\dmj\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "E:\conda_envs\dmj\lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 410, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000168A179E080>

  File "E:\conda_envs\dmj\lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000168A179DA80>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000168A179E080>

  File "E:\conda_envs\dmj\lib\site-packages\fastapi\applications.py", line 1135, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...

  File "E:\conda_envs\dmj\lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000168A4C0F7F0>
          └ <fastapi.applications.FastAPI object at 0x00000168A179DA80>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc

  File "E:\conda_envs\dmj\lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000168A4C12320>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000168A4C0F7C0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000168A4C0F7F0>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
          │    │               │      │        │                     └ Headers({'host': '127.0.0.1:8000', 'connection': 'keep-alive', 'content-length': '50', 'sec-ch-ua-platform': '"Windows"', 'us...
          │    │               │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000168A4C12320>
          │    │               │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49...
          │    │               └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function CORSMiddleware.simple_response at 0x00000168A2930F70>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000168A4C0F7C0>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
          │    │   │      │        └ functools.partial(<bound method CORSMiddleware.send of <starlette.middleware.cors.CORSMiddleware object at 0x00000168A4C0F7C0...
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000168A4C49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000168A4C0F730>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000168A4C0F7C0>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\middleware\base.py", line 198, in __call__
    raise app_exc
          └ NameError("name 'crud' is not defined")

  File "E:\conda_envs\dmj\lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000168A4C12D40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000168A4C0F700>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000168A4C0F730>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000168A4C12D40>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000168A4C490F0>
          │                            │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000168A4C0F6A0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000168A4C0F700>
          └ <function wrap_app_handling_exceptions at 0x00000168A2808670>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc

  File "E:\conda_envs\dmj\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABB50>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000168A4C0F6A0>

  File "E:\conda_envs\dmj\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABB50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000168A179D330>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000168A4C0F6A0>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABB50>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000168A179D330>>
          └ <fastapi.routing.APIRouter object at 0x00000168A179D330>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABB50>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000168A2809CF0>
          └ APIRoute(path='/api/v1/listen/start', name='start_listen', methods=['POST'])

  File "E:\conda_envs\dmj\lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABB50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000168A4C11CF0>
          └ APIRoute(path='/api/v1/listen/start', name='start_listen', methods=['POST'])

  File "E:\conda_envs\dmj\lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABB50>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000168A4CA5A80>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000168A4CABBE0>
          └ <function wrap_app_handling_exceptions at 0x00000168A2808670>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc

  File "E:\conda_envs\dmj\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABC70>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000168A4CABBE0>

  File "E:\conda_envs\dmj\lib\site-packages\fastapi\routing.py", line 102, in app
    await response(scope, receive, send)
          │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000168A4CABC70>
          │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000168A4C125F0>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <starlette.responses.JSONResponse object at 0x00000168A4CA7D30>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\responses.py", line 167, in __call__
    await self.background()
          │    └ <fastapi.background.BackgroundTasks object at 0x00000168A4CA7B80>
          └ <starlette.responses.JSONResponse object at 0x00000168A4CA7D30>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\background.py", line 36, in __call__
    await task()
          └ <starlette.background.BackgroundTask object at 0x00000168A4CA79A0>

  File "E:\conda_envs\dmj\lib\site-packages\starlette\background.py", line 21, in __call__
    await self.func(*self.args, **self.kwargs)
          │    │     │    │       │    └ {}
          │    │     │    │       └ <starlette.background.BackgroundTask object at 0x00000168A4CA79A0>
          │    │     │    └ (6229649, 'XRyon')
          │    │     └ <starlette.background.BackgroundTask object at 0x00000168A4CA79A0>
          │    └ <bound method BLiveService.start_listen of <backend.app.services.blive_service.BLiveService object at 0x00000168A29580D0>>
          └ <starlette.background.BackgroundTask object at 0x00000168A4CA79A0>

  File "D:\WorkFiles\Py_project\test\danmuji\bilidmj_michong\backend\app\services\blive_service.py", line 182, in start_listen
    user = await crud.get_user_by_name(db, user_name)
                                       │   └ 'XRyon'
                                       └ <sqlalchemy.orm.session.AsyncSession object at 0x00000168A4C48040>

NameError: name 'crud' is not defined
