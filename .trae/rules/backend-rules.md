---
alwaysApply: true
---
## 1. 目录结构规范

所有后端 `app` 模块必须严格遵守五层架构，确保职责分离：

* **`api/`**: 路由层，负责请求分发与 HTTP 响应。
* **`service/`**: 业务逻辑层，处理核心业务流程与逻辑。
* **`model/`**: 数据模型层，定义数据库 ORM 对象。
* **`crud/`**: 数据访问层，封装底层数据库增删改查操作。
* **`schema/`**: 数据校验层，定义 Pydantic 模型(包含约束和描述)。


## 2. API 设计与文档规范

* **RESTful 风格**: 接口路径必须使用**名词单数**形式。
* **类型声明**: 所有接口返回值必须具备明确的 **类型声明/Schema 引用**，确保 API 文档中能正确解析并展示响应体的数据结构。


## 3. 代码注释规范

创建函数时必须生成标准化的函数级注释，包含以下关键字段：

| 字段 | 说明 |
| --- | --- |
| **Description** | 简洁描述函数的核心功能 |
| **Args** | 参数名称、类型及含义 |
| **Return** | 返回值类型及描述 |
| **Raises** | 可能抛出的异常类型及触发条件 |


## 4. 数据库事务管理

* **事务处理**: 数据库操作必须确保符合**ACID**标准,涉及多表操作或连续写操作时，必须显式开启**事务处理**，确保数据一致性。


## 5. 异常处理

异常需进行明确分类处理，遵循以下分发原则：

* **前端可见异常**: 业务逻辑错误、权限不足、参数校验失败等，需返回友好的错误信息。
* **后端内部异常**: 系统崩溃、数据库连接异常、敏感配置错误等，需记录详细日志，前端仅展示系统错误提示。


## 6. 测试与质量保证

* **单元测试**: 所有生成的业务逻辑代码必须配套单元测试。
* **测试框架**: 统一采用 **pytest** 编写测试用例。
